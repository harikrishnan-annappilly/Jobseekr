@model IEnumerable<Jobseekr.Models.Enquiry>

@{
    ViewBag.Title = "ViewAllEnquiries";          // this view is for admin
}

<!DOCTYPE html>
<html class="no-js" lang="zxx">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.svg" />

</head>
<body>

    <div id="loading-area"></div>
    <!-- Start Header Area -->
    <header class="header other-page">
        <div class="navbar-area">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-12">
                        <nav class="navbar navbar-expand-lg">
                            <a class="navbar-brand logo" href="index.html">
                                <img class="logo1" src="~/assets/images/logo/logo.jpg" alt="Logo" />
                            </a>
                            <button class="navbar-toggler" type="button" data-toggle="collapse"
                                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                    aria-expanded="false" aria-label="Toggle navigation">
                                <span class="toggler-icon"></span>
                                <span class="toggler-icon"></span>
                                <span class="toggler-icon"></span>
                            </button>
                            <div class="collapse navbar-collapse sub-menu-bar" id="navbarSupportedContent">
                                <ul id="nav" class="navbar-nav ml-auto">
                                    <li class="nav-item">
                                        <a href="@Url.Action("ViewAllEmployees", "Jobseekr")">Employees</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="@Url.Action("ViewAllEmployers", "Jobseekr")">Employers</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="@Url.Action("ViewAllCompanyProfiles", "Jobseekr")">Companies</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="@Url.Action("ViewAllJobs", "Jobseekr")">Jobs</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="@Url.Action("ViewAllJobApplications", "Jobseekr")">Job Applications</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="@Url.Action("ViewAllEnquiries", "Jobseekr")" class="active">Enquiries</a>
                                    </li>
                                    <li class="nav-item">
                                        <a href="@Url.Action("ViewAllReviewsandRatings", "Jobseekr")">Review & Ratings</a>
                                    </li>
                                </ul>
                            </div>
                            <!-- navbar collapse -->
                            <div class="button">
                                <a href="@Url.Action("Logout", "Jobseekr")" data-toggle="modal" data-target="@Url.Action("Logout", "Jobseekr")" class="login">
                                    <i class="lni lni-exit"></i> Logout
                                </a>
                            </div>
                        </nav>
                        <!-- navbar -->
                    </div>
                </div>
                <!-- row -->
            </div>
            <!-- container -->
        </div>
        <!-- navbar area -->
    </header>
    <!-- End Header Area -->
    <!-- Start Breadcrumbs -->
    <div class="breadcrumbs overlay">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="breadcrumbs-content">
                        <h1 class="page-title">Enquiries</h1>
                        <p>
                            Business plan draws on a wide range of knowledge from different business<br> disciplines.
                            Business draws on a wide range of different business .
                        </p>
                    </div>
                    <ul class="breadcrumb-nav">
                        <li><a href="index.html">Home</a></li>
                        <li>Enquiries</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- End Breadcrumbs -->
    <section class="job-post section">
        <div class="container">
            <div class="row">
                @foreach (var item in Model)
                {
                    <div class="col-lg-10 offset-lg-1 col-12">
                        <div class="job-information">
                            <h3 class="title">
                                Enquiry   @Html.DisplayFor(modelItem => item.EnquiryId)
                            </h3>
                            <div class="row">
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        @Html.DisplayFor(modelItem => item.Name)
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        @Html.DisplayFor(modelItem => item.Email)
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        @Html.DisplayFor(modelItem => item.Subject)
                                    </div>
                                </div>
                                <div class="col-lg-6 col-md-6">
                                    <div class="form-group">
                                        @Html.DisplayFor(modelItem => item.Message)
                                    </div>
                                    <div class="form-group">
                                        Reply: @Html.DisplayFor(modelItem => item.Reply)
                                    </div>
                                    <div class="col-lg-12 button">
                                        <div class="form-group">
                                            <label for="adminReply">Admin Reply:</label>
                                            <textarea class="form-control" id="adminReply-@item.EnquiryId" rows="3"></textarea>
                                        </div>
                                        <button type="button" class="btn btn-primary submit-reply" data-enquiryid="@item.EnquiryId">Submit Reply</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                }
            </div>
    </section>
  
    <!-- ========================= scroll-top ========================= -->
    <a href="#" class="scroll-top btn-hover">
        <i class="lni lni-chevron-up"></i>
    </a>

    <!-- Add success and error alert elements -->
    <!-- ... Your existing form and script sections ... -->
    <div class="toast-container position-fixed p-3" style="top: 1rem; right: 1rem; z-index: 1000">
        <div id="success-toast" class="toast bg-success text-white" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="mr-auto">Success</strong>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body" id="success-toast-body">
                Enquiry submitted successfully!
            </div>
        </div>
        <div id="error-toast" class="toast bg-danger text-white" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="mr-auto">Error</strong>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body" id="error-toast-body">
                Enquiry submission failed. Please fill all fields and try again.
            </div>
        </div>
    </div>

    <!-- This script, executed when the DOM is fully loaded, handles the submission of admin replies through AJAX. -->
    <!-- It listens for clicks on elements with the class "submit-reply", extracts necessary data, sends a POST request to the server-side action. -->
    <script>
            $(document).ready(function () {
                $(".submit-reply").on("click", function () {
                    var enquiryId = $(this).data("enquiryid");
                    var adminReply = $("#adminReply-" + enquiryId).val();

                    $.ajax({
                        type: "POST",
                        url: "@Url.Action("ViewAllEnquiries", "Jobseekr")",
                        data: {
                            enquiryId: enquiryId,
                            adminReply: adminReply
                        },
                        success: function (data) {
                            // Handle success
                            if (data.success) {
                                // Show success alert
                                $("#success-alert").fadeIn(500);
                                setTimeout(function () {
                                    $("#success-alert").fadeOut(500);
                                    // Reload the page
                                    location.reload(true);
                                }, 1000);
                            } else {
                                // Show error alert
                                $("#error-alert").fadeIn(500);
                                setTimeout(function () {
                                    $("#error-alert").fadeOut(500);
                                }, 1000);
                            }
                        },
                        error: function () {
                            // Handle error
                            $("#error-alert").fadeIn(500, function () {
                                $(this).fadeOut(1000);
                            });
                        }
                    });
                });
            });
    </script>


</body>
</html>
